# Run quality checks and security scans before commit
# Quality checks (currently disabled - uncomment if needed)
# npm run quality:check

# üîí SECURITY SCAN - Prevent secrets from being committed
echo "üîç Scanning for secrets and credentials..."
if command -v gitleaks &> /dev/null; then
    gitleaks protect --verbose --redact --staged
    if [ $? -ne 0 ]; then
        echo ""
        echo "‚ùå COMMIT BLOCKED: Secrets detected!"
        echo "üí° Fix the issues above and try again"
        echo "üí° To bypass (emergency only): SKIP=gitleaks git commit -m 'message'"
        exit 1
    fi
    echo "‚úÖ No secrets detected"
else
    echo "‚ö†Ô∏è Warning: gitleaks not installed - install with: brew install gitleaks"
fi

# Additional secret detection with detect-secrets (if available)
if command -v detect-secrets &> /dev/null; then
    detect-secrets scan --baseline .secrets.baseline --force-use-all-plugins . 2>/dev/null
    if [ $? -ne 0 ]; then
        echo "‚ö†Ô∏è Additional secrets may be present - review carefully"
    fi
fi
