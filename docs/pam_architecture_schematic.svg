<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="600" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#1a1a1a">
    PAM System Architecture - How It Works
  </text>
  
  <!-- User Section -->
  <g id="user-section">
    <!-- User Icon -->
    <circle cx="100" cy="400" r="30" fill="#4a90e2" stroke="#2c5282" stroke-width="2"/>
    <text x="100" y="450" font-size="14" text-anchor="middle" fill="#1a1a1a">User</text>
    
    <!-- User Actions -->
    <rect x="40" y="320" width="120" height="40" rx="5" fill="#e8f4fd" stroke="#4a90e2" stroke-width="1"/>
    <text x="100" y="345" font-size="12" text-anchor="middle" fill="#1a1a1a">Types or Speaks</text>
  </g>
  
  <!-- Frontend Section -->
  <g id="frontend">
    <rect x="220" y="300" width="200" height="200" rx="10" fill="#f0f9ff" stroke="#3b82f6" stroke-width="2"/>
    <text x="320" y="330" font-size="16" font-weight="bold" text-anchor="middle" fill="#1a1a1a">Frontend (React)</text>
    
    <!-- Chat Interface -->
    <rect x="240" y="350" width="160" height="60" rx="5" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
    <text x="320" y="375" font-size="12" text-anchor="middle" fill="#1a1a1a">PamSimple.tsx</text>
    <text x="320" y="395" font-size="10" text-anchor="middle" fill="#666">Chat Interface</text>
    
    <!-- WebSocket Hook -->
    <rect x="240" y="420" width="160" height="60" rx="5" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
    <text x="320" y="445" font-size="12" text-anchor="middle" fill="#1a1a1a">WebSocket Hook</text>
    <text x="320" y="465" font-size="10" text-anchor="middle" fill="#666">Real-time Connection</text>
  </g>
  
  <!-- WebSocket Connection -->
  <g id="websocket">
    <path d="M 420 400 L 500 400" stroke="#10b981" stroke-width="3" stroke-dasharray="5,5"/>
    <text x="460" y="390" font-size="11" text-anchor="middle" fill="#059669">WebSocket</text>
    <text x="460" y="420" font-size="9" text-anchor="middle" fill="#666">wss://</text>
  </g>
  
  <!-- Backend Section -->
  <g id="backend">
    <rect x="500" y="250" width="250" height="300" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="625" y="280" font-size="16" font-weight="bold" text-anchor="middle" fill="#1a1a1a">Backend (FastAPI)</text>
    
    <!-- API Router -->
    <rect x="520" y="300" width="210" height="50" rx="5" fill="#ffffff" stroke="#fbbf24" stroke-width="1"/>
    <text x="625" y="320" font-size="12" text-anchor="middle" fill="#1a1a1a">/api/v1/pam.py</text>
    <text x="625" y="338" font-size="10" text-anchor="middle" fill="#666">Message Router</text>
    
    <!-- Simple Gemini Service -->
    <rect x="520" y="360" width="210" height="60" rx="5" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
    <text x="625" y="380" font-size="12" text-anchor="middle" fill="#1a1a1a">Simple Gemini Service</text>
    <text x="625" y="398" font-size="10" text-anchor="middle" fill="#166534">‚úì Function Calling Active</text>
    <text x="625" y="410" font-size="9" text-anchor="middle" fill="#666">Primary AI Service</text>
    
    <!-- Tool Registry -->
    <rect x="520" y="430" width="100" height="50" rx="5" fill="#ffffff" stroke="#fbbf24" stroke-width="1"/>
    <text x="570" y="450" font-size="11" text-anchor="middle" fill="#1a1a1a">Tool Registry</text>
    <text x="570" y="465" font-size="9" text-anchor="middle" fill="#666">Available Tools</text>
    
    <!-- Function Handler -->
    <rect x="630" y="430" width="100" height="50" rx="5" fill="#ffffff" stroke="#fbbf24" stroke-width="1"/>
    <text x="680" y="450" font-size="11" text-anchor="middle" fill="#1a1a1a">Function Handler</text>
    <text x="680" y="465" font-size="9" text-anchor="middle" fill="#666">Tool Execution</text>
    
    <!-- Auth & Security -->
    <rect x="520" y="490" width="210" height="40" rx="5" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
    <text x="625" y="505" font-size="11" text-anchor="middle" fill="#1a1a1a">Auth & Rate Limiting</text>
    <text x="625" y="520" font-size="9" text-anchor="middle" fill="#666">JWT + Security</text>
  </g>
  
  <!-- AI Provider (Gemini) -->
  <g id="gemini">
    <rect x="820" y="340" width="180" height="100" rx="10" fill="#f3e8ff" stroke="#9333ea" stroke-width="2"/>
    <text x="910" y="365" font-size="14" font-weight="bold" text-anchor="middle" fill="#1a1a1a">Google Gemini</text>
    <text x="910" y="385" font-size="11" text-anchor="middle" fill="#581c87">1.5 Flash Model</text>
    <text x="910" y="405" font-size="10" text-anchor="middle" fill="#666">25x Cheaper</text>
    <text x="910" y="420" font-size="10" text-anchor="middle" fill="#666">1M Token Context</text>
  </g>
  
  <!-- Tools Section -->
  <g id="tools">
    <text x="625" y="580" font-size="14" font-weight="bold" text-anchor="middle" fill="#1a1a1a">Available Tools</text>
    
    <!-- Financial Tool -->
    <rect x="480" y="600" width="90" height="60" rx="5" fill="#e0f2fe" stroke="#0284c7" stroke-width="1"/>
    <text x="525" y="620" font-size="11" text-anchor="middle" fill="#1a1a1a">üí∞ Finance</text>
    <text x="525" y="635" font-size="9" text-anchor="middle" fill="#666">Expenses</text>
    <text x="525" y="648" font-size="9" text-anchor="middle" fill="#666">Budgets</text>
    
    <!-- Navigation Tool -->
    <rect x="580" y="600" width="90" height="60" rx="5" fill="#e0f2fe" stroke="#0284c7" stroke-width="1"/>
    <text x="625" y="620" font-size="11" text-anchor="middle" fill="#1a1a1a">üó∫Ô∏è Navigation</text>
    <text x="625" y="635" font-size="9" text-anchor="middle" fill="#666">Routes</text>
    <text x="625" y="648" font-size="9" text-anchor="middle" fill="#666">Campgrounds</text>
    
    <!-- Search Tool -->
    <rect x="680" y="600" width="90" height="60" rx="5" fill="#e0f2fe" stroke="#0284c7" stroke-width="1"/>
    <text x="725" y="620" font-size="11" text-anchor="middle" fill="#1a1a1a">üîç Search</text>
    <text x="725" y="635" font-size="9" text-anchor="middle" fill="#666">YouTube</text>
    <text x="725" y="648" font-size="9" text-anchor="middle" fill="#666">Travel Info</text>
  </g>
  
  <!-- Database -->
  <g id="database">
    <rect x="820" y="480" width="180" height="80" rx="10" fill="#f0fdf4" stroke="#16a34a" stroke-width="2"/>
    <text x="910" y="505" font-size="14" font-weight="bold" text-anchor="middle" fill="#1a1a1a">Supabase DB</text>
    <text x="910" y="525" font-size="10" text-anchor="middle" fill="#666">PostgreSQL</text>
    <text x="910" y="540" font-size="10" text-anchor="middle" fill="#666">User Data</text>
    <text x="910" y="555" font-size="10" text-anchor="middle" fill="#666">Conversations</text>
  </g>
  
  <!-- Flow Arrows -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
  </defs>
  
  <!-- User to Frontend -->
  <path d="M 160 400 L 220 400" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="190" y="395" font-size="10" text-anchor="middle" fill="#666">1</text>
  
  <!-- Backend to Gemini -->
  <path d="M 750 390 L 820 390" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="785" y="385" font-size="10" text-anchor="middle" fill="#666">2</text>
  
  <!-- Gemini back to Backend -->
  <path d="M 820 410 L 750 410" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="785" y="425" font-size="10" text-anchor="middle" fill="#666">3</text>
  
  <!-- Backend to Tools -->
  <path d="M 625 480 L 625 600" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="640" y="540" font-size="10" fill="#666">4</text>
  
  <!-- Backend to Database -->
  <path d="M 750 520 L 820 520" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="785" y="515" font-size="10" text-anchor="middle" fill="#666">5</text>
  
  <!-- Response Flow Labels -->
  <g id="flow-labels">
    <rect x="50" y="700" width="1100" height="80" rx="10" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
    <text x="600" y="725" font-size="14" font-weight="bold" text-anchor="middle" fill="#1a1a1a">Message Flow</text>
    
    <text x="100" y="750" font-size="11" fill="#1a1a1a">1. User types message</text>
    <text x="100" y="765" font-size="11" fill="#1a1a1a">   "What's my budget?"</text>
    
    <text x="300" y="750" font-size="11" fill="#1a1a1a">2. WebSocket sends to</text>
    <text x="300" y="765" font-size="11" fill="#1a1a1a">   backend API</text>
    
    <text x="500" y="750" font-size="11" fill="#1a1a1a">3. Gemini processes</text>
    <text x="500" y="765" font-size="11" fill="#1a1a1a">   with function calling</text>
    
    <text x="700" y="750" font-size="11" fill="#1a1a1a">4. Tools execute</text>
    <text x="700" y="765" font-size="11" fill="#1a1a1a">   (check budget)</text>
    
    <text x="900" y="750" font-size="11" fill="#1a1a1a">5. Response sent back</text>
    <text x="900" y="765" font-size="11" fill="#1a1a1a">   to user via WebSocket</text>
  </g>
  
  <!-- Status Indicators -->
  <g id="status">
    <circle cx="50" cy="50" r="5" fill="#22c55e"/>
    <text x="65" y="55" font-size="11" fill="#666">Active</text>
    
    <circle cx="50" cy="70" r="5" fill="#f59e0b"/>
    <text x="65" y="75" font-size="11" fill="#666">Processing</text>
    
    <circle cx="50" cy="90" r="5" fill="#ef4444"/>
    <text x="65" y="95" font-size="11" fill="#666">Error</text>
  </g>
  
  <!-- Version Info -->
  <text x="1150" y="790" font-size="10" text-anchor="end" fill="#999">PAM v2.1 - January 2025</text>
</svg>