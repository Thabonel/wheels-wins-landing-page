# Project Handover Document
**Date:** January 17, 2025
**Project:** Wheels & Wins - RV Lifestyle Platform

---

## Project Overview

Wheels & Wins is a comprehensive RV lifestyle platform featuring:
- **PAM (Personal Assistant for Mobility)** - AI-powered voice and text assistant
- **Life Transition Navigator** - Tools for transitioning to RV living
- **Trip Planning** - Route planning with campground recommendations
- **Budget Tracking** - Expense and financial management
- **Social Features** - Community posts, friends, messaging
- **Shop** - Affiliate products marketplace

### Tech Stack
- **Frontend:** React 18.3 + TypeScript + Vite + Tailwind CSS
- **Backend:** FastAPI (Python) hosted on Render
- **Database:** Supabase (PostgreSQL)
- **AI:** Claude Sonnet 4.5 (primary) + GPT-5.1 (fallback)
- **Voice:** OpenAI Realtime API + Claude hybrid architecture

---

## Recent Work Completed (January 2025)

### 1. Transition Checklist Bug Fix
**Issue:** Checkboxes wouldn't tick and tasks couldn't be added
**Root Cause:** PostgreSQL trigger functions had `SET search_path TO ''` preventing table access
**Fix:** Updated `update_profile_completion()` and `calculate_transition_completion()` with proper search_path
**Commit:** `033319e9`
**SQL Fix:** `docs/sql-fixes/FIX_TRANSITION_TASKS_TRIGGER.sql`

### 2. Transition Checklist Edit Functionality
**Feature:** Added ability to edit and delete tasks in the Transition Checklist
**Changes:**
- Renamed `AddTaskDialog.tsx` to `TaskDialog.tsx` with edit mode support
- Added pencil icon to each task row
- Added edit/delete handlers to `TransitionDashboard.tsx`
- Delete button with confirmation dialog
**Commit:** `8912f62c`

### 3. PAM Voice Fix
**Issue:** PAM voice going silent after tool execution
**Commit:** `fcac287c`

---

## Current System State

### PAM (AI Assistant)

**Architecture:**
- Text mode: WebSocket to FastAPI backend, Claude processes with 47 tools
- Voice mode: OpenAI Realtime API for voice I/O + Claude for reasoning (hybrid)

**Key Files:**
- `src/services/pamService.ts` - Text mode WebSocket client
- `src/services/pamVoiceHybridService.ts` - Voice mode service
- `src/services/wakeWordService.ts` - "Hey PAM" detection
- `backend/app/api/v1/pam_realtime_hybrid.py` - Voice WebSocket bridge
- `backend/app/services/pam/` - PAM tools and services

**WebSocket Endpoints:**
- Production: `wss://pam-backend.onrender.com/api/v1/pam/ws/{user_id}?token={jwt}`
- Staging: `wss://wheels-wins-backend-staging.onrender.com/api/v1/pam/ws/{user_id}?token={jwt}`

**Known Issue:** Voice mode profile/tools access may still have issues - the cache warming service returns data but tools may not receive it in the expected format.

### Transition Module

**Tables:**
- `transition_profiles` - User's transition settings and progress
- `transition_tasks` - Checklist tasks with subtasks
- `transition_timeline` - Milestones
- `transition_financial` - Financial buckets (transition, emergency, travel)

**Key Files:**
- `src/components/transition/TransitionDashboard.tsx` - Main dashboard
- `src/components/transition/TransitionChecklist.tsx` - Task list with checkboxes
- `src/components/transition/TaskDialog.tsx` - Add/edit task dialog
- `src/types/transition.types.ts` - TypeScript type definitions

**Trigger Functions (recently fixed):**
- `update_profile_completion()` - Updates completion percentage on task changes
- `calculate_transition_completion()` - Calculates percentage of completed tasks

---

## Environment Configuration

### Development
```bash
npm run dev          # Frontend on http://localhost:8080
cd backend && uvicorn app.main:app --reload --port 8000  # Backend
```

### Key Environment Variables

**Frontend (.env):**
```
VITE_SUPABASE_URL=https://kycoklimpzkyrecbjecn.supabase.co
VITE_SUPABASE_ANON_KEY=...
VITE_API_BASE_URL=https://pam-backend.onrender.com  # or staging URL
```

**Backend (backend/.env):**
```
DATABASE_URL=postgresql://...
SUPABASE_SERVICE_ROLE_KEY=...
ANTHROPIC_API_KEY=...
REDIS_URL=...
```

### Supabase Project
- **URL:** https://kycoklimpzkyrecbjecn.supabase.co
- **Project Ref:** kycoklimpzkyrecbjecn

---

## Deployment

### URLs
| Environment | Frontend | Backend |
|-------------|----------|---------|
| Production | https://wheelsandwins.com | https://pam-backend.onrender.com |
| Staging | https://wheels-wins-staging.netlify.app | https://wheels-wins-backend-staging.onrender.com |

### Branch Strategy
- `staging` - Development/testing branch
- `main` - Production branch
- Feature branches merge to `staging` first

### Deployment Commands
```bash
git push origin staging              # Deploy to staging
git push origin staging:main         # Deploy to production
```

---

## Known Issues & Technical Debt

### High Priority
1. **PAM Voice Profile Access** - Voice mode may not have full access to user profile/tools. The `get_cached_user_context()` in `cache_warming.py` was fixed but needs verification.

### Medium Priority
2. **Supabase Type Generation** - The generated types don't include transition tables, causing IDE warnings (but build passes)
3. **Dependabot Vulnerability** - 1 low severity vulnerability flagged by GitHub

### Low Priority
4. **Unused imports** - Some files have unused React imports after cleanup

---

## Important Documentation

| Document | Location | Description |
|----------|----------|-------------|
| Project Instructions | `CLAUDE.md` | Main development guidelines |
| Database Schema | `docs/DATABASE_SCHEMA_REFERENCE.md` | All table schemas |
| PAM Architecture | `docs/PAM_SYSTEM_ARCHITECTURE.md` | PAM system overview |
| PAM Context | `docs/PAM_BACKEND_CONTEXT_REFERENCE.md` | Backend field names |
| Naming Conventions | `docs/NAMING_CONVENTIONS_MASTER.md` | Field name mappings |
| SQL Fixes | `docs/sql-fixes/` | Database fix scripts |

---

## Testing Checklist

Before deploying changes:
- [ ] `npm run type-check` - TypeScript validation
- [ ] `npm run lint` - Linting
- [ ] `npm run build` - Production build
- [ ] Test on mobile (375px, 768px, 1024px)
- [ ] Test dark mode
- [ ] Test PAM text mode
- [ ] Test PAM voice mode (if changed)

---

## Contacts & Resources

- **GitHub:** https://github.com/Thabonel/wheels-wins-landing-page
- **Supabase Dashboard:** https://supabase.com/dashboard/project/kycoklimpzkyrecbjecn
- **Netlify:** Frontend hosting
- **Render:** Backend hosting

---

## Next Steps / Recommendations

1. **Verify PAM Voice** - Test voice mode with profile questions ("What's my name?", "What vehicle do I drive?")
2. **Regenerate Supabase Types** - Run type generation to include transition tables
3. **Address Dependabot** - Review and fix the low severity vulnerability
4. **Add Tests** - The transition module lacks unit tests

---

*Document generated: January 17, 2025*
